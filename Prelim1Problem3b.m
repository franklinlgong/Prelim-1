%Stoichiometric Matrix
syms n a;
n = 1;
a = 1;
Aeq = [-1 1 0 0 0 0 0 0 0 0 0 0 0 0 0;
       -1 1 0 0 0 0 0 0 0 0 0 0 0 0 0;
       1 -1 0 0 0 0 0 0 0 0 0 0 0 0 0;
       0 -n 0 0 0 0 0 1 0 0 0 0 0 0 0;
       0 1 -1 -1 1 0 0 0 0 0 0 0 0 0 0;
       0 2*n 0 0 2*a 2 0 0 0 0 0 0 0 0 -1;
       0 0 n 0 0 0 0 0 0 -1 0 0 0 0 0;
       0 0 0 -1 1 0 0 0 0 0 0 0 0 0 0;
       0 0 0 1 -1 0 0 0 0 0 0 0 0 0 0;
       0 0 0 0 -a 1 0 0 0 0 0 0 0 0 0;
       0 0 0 0 -2*a 0 0 0 0 0 0 0 1 0 0;
       0 0 0 0 a -1 0 0 0 0 0 0 0 0 0;
       0 0 0 0 2*a 0 0 0 0 0 0 0 0 -1 0;
       0 0 0 0 1 0 0 0 -1 0 0 0 0 0 0;
       0 0 0 0 0 -1 1 0 0 0 0 0 0 0 0;
       0 0 0 0 0 -1 0 0 0 0 1 0 0 0 0;
       0 0 0 0 0 1 0 0 0 0 0 -1 0 0 0.0;];

%Linear inequalities initialization
A = [];
b = [];

%Steady state rates
beq = [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]';

%Calculate v2 and v5 limit at multiple inducer I
I = [1.0000e-04 1e-3 0.01 0.1 1 10];
rx = zeros(6,1);
rl = zeros(6,1);
rx(1) = (0.15*60/1000*0.005)/(0.3*2.7+0.3*0.005*(1+2.7))*(0.26+300*(I(1)^1.5/(I(1)^1.5+0.3^1.5)))/(1+0.26+300*(I(1)^1.5/(I(1)^1.5+0.3^1.5)));
rx(2) = (0.15*60/1000*0.005)/(0.3*2.7+0.3*0.005*(1+2.7))*(0.26+300*(I(2)^1.5/(I(2)^1.5+0.3^1.5)))/(1+0.26+300*(I(2)^1.5/(I(2)^1.5+0.3^1.5)));
rx(3) = (0.15*60/1000*0.005)/(0.3*2.7+0.3*0.005*(1+2.7))*(0.26+300*(I(3)^1.5/(I(3)^1.5+0.3^1.5)))/(1+0.26+300*(I(3)^1.5/(I(3)^1.5+0.3^1.5)));
rx(4) = (0.15*60/1000*0.005)/(0.3*2.7+0.3*0.005*(1+2.7))*(0.26+300*(I(4)^1.5/(I(4)^1.5+0.3^1.5)))/(1+0.26+300*(I(4)^1.5/(I(4)^1.5+0.3^1.5)));
rx(5) = (0.15*60/1000*0.005)/(0.3*2.7+0.3*0.005*(1+2.7))*(0.26+300*(I(5)^1.5/(I(5)^1.5+0.3^1.5)))/(1+0.26+300*(I(5)^1.5/(I(5)^1.5+0.3^1.5)));
rx(6) = (0.15*60/1000*0.005)/(0.3*2.7+0.3*0.005*(1+2.7))*(0.26+300*(I(6)^1.5/(I(6)^1.5+0.3^1.5)))/(1+0.26+300*(I(6)^1.5/(I(6)^1.5+0.3^1.5)));

rl(1) = (1.6*16.5/330*rx(1)*(1-8.35/3600))/(57*0.8+57*rx(1)*(1-8.35/3600)*(1+0.8));
rl(2) = (1.6*16.5/330*rx(2)*(1-8.35/3600))/(57*0.8+57*rx(2)*(1-8.35/3600)*(1+0.8));
rl(3) = (1.6*16.5/330*rx(3)*(1-8.35/3600))/(57*0.8+57*rx(3)*(1-8.35/3600)*(1+0.8));
rl(4) = (1.6*16.5/330*rx(4)*(1-8.35/3600))/(57*0.8+57*rx(4)*(1-8.35/3600)*(1+0.8));
rl(5) = (1.6*16.5/330*rx(5)*(1-8.35/3600))/(57*0.8+57*rx(5)*(1-8.35/3600)*(1+0.8));
rl(6) = (1.6*16.5/330*rx(6)*(1-8.35/3600))/(57*0.8+57*rx(6)*(1-8.35/3600)*(1+0.8));

%Set objective function
obj = [0 0 0 0 -1 0 0 0 0 0 0 0 0 0 0]';

%Set bounds and solve for each Inducer concentration
Proteins = zeros(6,1);
for s = 1:6
    lb = [0 rx(s) 0 0 0 0 -27.7 -27.7 -27.7 -27.7 -27.7 -27.7 -27.7 -27.7 -27.7]'; %uM/s
    ub = [27.7 rx(s) 27.7 27.7 rl(s) 27.7 27.7 27.7 27.7 27.7 27.7 27.7 27.7 27.7 27.7]';
    x=linprog(obj,A,b,Aeq,beq,lb,ub);
    Proteins(s) = x(5)*3600*(1-9.9*10^-3);
end

figure
semilogx(I,Proteins)
xlabel('Inducer concentration (mM)')
ylabel('Protein concentration (uM)')
